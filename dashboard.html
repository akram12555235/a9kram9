<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary: #667eea;
        --primary-dark: #5a6fd6;
        --secondary: #764ba2;
        --success: #28a745;
        --danger: #dc3545;
        --warning: #ffc107;
        --dark: #1a1a2e;
        --light: #f8f9fa;
        --gray: #6c757d;
      }

      body {
        font-family: "Segoe UI", Tahoma, sans-serif;
        background: linear-gradient(135deg, var(--dark) 0%, #16213e 100%);
        min-height: 100vh;
        direction: rtl;
        color: #fff;
      }

      /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
      .sidebar {
        position: fixed;
        right: 0;
        top: 0;
        width: 280px;
        height: 100vh;
        background: rgba(26, 26, 46, 0.95);
        border-left: 1px solid rgba(102, 126, 234, 0.3);
        padding: 20px;
        z-index: 1000;
        overflow-y: auto;
        transition: transform 0.3s;
      }

      .sidebar-header {
        text-align: center;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 20px;
      }

      .sidebar-header .logo {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }
      .sidebar-header h2 {
        color: var(--primary);
        font-size: 1.2rem;
      }

      .user-card {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        margin-bottom: 20px;
      }

      .user-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        margin: 0 auto 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        border: 3px solid rgba(255, 255, 255, 0.5);
        overflow: hidden;
      }

      .user-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .user-name {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 5px;
      }
      .user-username {
        opacity: 0.8;
        font-size: 0.9rem;
      }

      .nav-menu {
        list-style: none;
      }

      .nav-item {
        margin-bottom: 8px;
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 15px;
        border-radius: 10px;
        color: #fff;
        text-decoration: none;
        transition: all 0.3s;
        cursor: pointer;
      }

      .nav-link:hover,
      .nav-link.active {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        transform: translateX(-5px);
      }

      .nav-link .icon {
        font-size: 1.3rem;
      }
      .nav-link .badge {
        margin-right: auto;
        background: var(--danger);
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.75rem;
      }

      /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
      .main-content {
        margin-right: 280px;
        padding: 20px;
        min-height: 100vh;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        backdrop-filter: blur(10px);
      }

      .header h1 {
        font-size: 1.5rem;
      }

      .header-actions {
        display: flex;
        gap: 10px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: #fff;
      }
      .btn-danger {
        background: var(--danger);
        color: #fff;
      }
      .btn-success {
        background: var(--success);
        color: #fff;
      }
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      }

      /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        border-color: var(--primary);
      }

      .stat-icon {
        font-size: 2.5rem;
        margin-bottom: 15px;
      }
      .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary);
      }
      .stat-label {
        color: #aaa;
        margin-top: 5px;
      }

      /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
      .section {
        display: none;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .section.active {
        display: block;
        animation: fadeIn 0.3s;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .section-header h2 {
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
      .message-list {
        max-height: 500px;
        overflow-y: auto;
      }

      .message-card {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
        border-right: 4px solid var(--primary);
        transition: all 0.3s;
        cursor: pointer;
      }

      .message-card:hover {
        background: rgba(102, 126, 234, 0.1);
        transform: translateX(-5px);
      }
      .message-card.unread {
        border-right-color: var(--warning);
        background: rgba(255, 193, 7, 0.1);
      }

      .message-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .message-sender {
        font-weight: 600;
        color: var(--primary);
      }
      .message-date {
        font-size: 0.8rem;
        color: #888;
      }
      .message-subject {
        font-weight: 500;
        margin-bottom: 8px;
      }
      .message-preview {
        color: #aaa;
        font-size: 0.9rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ */
      .contacts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
      }

      .contact-card {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        transition: all 0.3s;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .contact-card:hover {
        border-color: var(--primary);
        transform: translateY(-3px);
      }

      .contact-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        margin: 0 auto 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
      }

      .contact-name {
        font-weight: 600;
        margin-bottom: 5px;
      }
      .contact-username {
        color: #888;
        font-size: 0.9rem;
        margin-bottom: 10px;
      }

      /* Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© */
      .compose-form {
        max-width: 600px;
      }

      .form-group {
        margin-bottom: 20px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #aaa;
      }

      .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        background: rgba(0, 0, 0, 0.3);
        color: #fff;
        font-size: 1rem;
        transition: all 0.3s;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 15px rgba(102, 126, 234, 0.3);
      }

      textarea.form-control {
        min-height: 150px;
        resize: vertical;
      }

      /* Ø§Ù„Ø¨Ø­Ø« */
      .search-box {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .search-box input {
        flex: 1;
      }

      .search-results {
        max-height: 300px;
        overflow-y: auto;
      }

      .search-result-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .search-result-item:hover {
        background: rgba(102, 126, 234, 0.2);
      }

      /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ */
      .profile-form {
        max-width: 500px;
      }

      .profile-image-upload {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        margin: 0 auto 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 3px dashed rgba(255, 255, 255, 0.3);
        transition: all 0.3s;
        overflow: hidden;
      }

      .profile-image-upload:hover {
        border-color: var(--primary);
      }
      .profile-image-upload img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        align-items: center;
        justify-content: center;
      }

      .modal.show {
        display: flex;
      }

      .modal-content {
        background: var(--dark);
        border-radius: 15px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-close {
        background: none;
        border: none;
        color: #fff;
        font-size: 1.5rem;
        cursor: pointer;
      }

      /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
      .toast {
        position: fixed;
        bottom: 20px;
        left: 20px;
        padding: 15px 25px;
        border-radius: 10px;
        color: #fff;
        font-weight: 500;
        z-index: 3000;
        animation: slideIn 0.3s;
      }

      .toast.success {
        background: var(--success);
      }
      .toast.error {
        background: var(--danger);
      }
      .toast.info {
        background: var(--primary);
      }

      @keyframes slideIn {
        from {
          transform: translateX(-100%);
          opacity: 0;
        }
      }

      /* Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
      .loading {
        text-align: center;
        padding: 40px;
        color: #888;
      }

      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .no-data {
        text-align: center;
        padding: 40px;
        color: #666;
      }

      .no-data .icon {
        font-size: 3rem;
        margin-bottom: 15px;
        opacity: 0.5;
      }

      /* Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
      .menu-toggle {
        display: none;
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1001;
        background: var(--primary);
        border: none;
        color: #fff;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-size: 1.5rem;
        cursor: pointer;
      }

      @media (max-width: 900px) {
        .sidebar {
          transform: translateX(100%);
        }
        .sidebar.open {
          transform: translateX(0);
        }
        .main-content {
          margin-right: 0;
        }
        .menu-toggle {
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 600px) {
        .stats-grid {
          grid-template-columns: 1fr;
        }
        .header {
          flex-direction: column;
          gap: 15px;
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <!-- Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
    <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>

    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">ğŸ›ï¸</div>
        <h2>Ù…Ù†Ø¸Ù…Ø© Ø£ÙƒØ±Ù…</h2>
      </div>

      <div class="user-card">
        <div class="user-avatar" id="sidebarAvatar">ğŸ‘¤</div>
        <div class="user-name" id="sidebarName">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        <div class="user-username" id="sidebarUsername">@...</div>
      </div>

      <ul class="nav-menu">
        <li class="nav-item">
          <a class="nav-link active" onclick="showSection('home')">
            <span class="icon">ğŸ </span> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" onclick="showSection('inbox')">
            <span class="icon">ğŸ“¥</span> Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©
            <span class="badge" id="inboxBadge" style="display: none">0</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" onclick="showSection('outbox')">
            <span class="icon">ğŸ“¤</span> Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" onclick="showSection('compose')">
            <span class="icon">âœ‰ï¸</span> Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" onclick="showSection('contacts')">
            <span class="icon">ğŸ‘¥</span> Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" onclick="showSection('search')">
            <span class="icon">ğŸ”</span> Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¹Ø¶Ø§Ø¡
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" onclick="showSection('profile')">
            <span class="icon">âš™ï¸</span> Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
          </a>
        </li>
        <li class="nav-item" id="adminNavItem" style="display: none">
          <a class="nav-link" onclick="showSection('admin')">
            <span class="icon">ğŸ›¡ï¸</span> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
            <span class="badge" id="adminBadge" style="display: none">0</span>
          </a>
        </li>
      </ul>

      <div
        style="
          margin-top: auto;
          padding-top: 20px;
          border-top: 1px solid rgba(255, 255, 255, 0.1);
        "
      >
        <a class="nav-link" onclick="logout()" style="color: #ff6b6b">
          <span class="icon">ğŸšª</span> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </a>
      </div>
    </aside>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="main-content">
      <div class="header">
        <h1 id="pageTitle">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h1>
        <div class="header-actions">
          <button class="btn btn-primary" onclick="showSection('compose')">
            âœ‰ï¸ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
          </button>
        </div>
      </div>

      <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
      <div class="stats-grid" id="statsGrid">
        <div class="stat-card">
          <div class="stat-icon">ğŸ“¥</div>
          <div class="stat-number" id="statInbox">0</div>
          <div class="stat-label">Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ø±Ø¯Ø©</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ“¤</div>
          <div class="stat-number" id="statOutbox">0</div>
          <div class="stat-label">Ø±Ø³Ø§Ø¦Ù„ Ù…Ø±Ø³Ù„Ø©</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ‘¥</div>
          <div class="stat-number" id="statContacts">0</div>
          <div class="stat-label">Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ“…</div>
          <div class="stat-number" id="statJoinDate">-</div>
          <div class="stat-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</div>
        </div>
      </div>

      <!-- Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <section id="section-home" class="section active">
        <div class="section-header">
          <h2>ğŸ“¬ Ø¢Ø®Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h2>
          <button class="btn btn-primary" onclick="showSection('inbox')">
            Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
          </button>
        </div>
        <div class="message-list" id="recentMessages">
          <div class="loading">
            <div class="spinner"></div>
            Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...
          </div>
        </div>
      </section>

      <!-- Ù‚Ø³Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© -->
      <section id="section-inbox" class="section">
        <div class="section-header">
          <h2>ğŸ“¥ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h2>
          <button class="btn btn-primary" onclick="loadInbox()">
            ğŸ”„ ØªØ­Ø¯ÙŠØ«
          </button>
        </div>
        <div class="message-list" id="inboxList">
          <div class="loading">
            <div class="spinner"></div>
            Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...
          </div>
        </div>
      </section>

      <!-- Ù‚Ø³Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø© -->
      <section id="section-outbox" class="section">
        <div class="section-header">
          <h2>ğŸ“¤ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©</h2>
          <button class="btn btn-primary" onclick="loadOutbox()">
            ğŸ”„ ØªØ­Ø¯ÙŠØ«
          </button>
        </div>
        <div class="message-list" id="outboxList">
          <div class="loading">
            <div class="spinner"></div>
            Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...
          </div>
        </div>
      </section>

      <!-- Ù‚Ø³Ù… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© -->
      <section id="section-compose" class="section">
        <div class="section-header">
          <h2>âœ‰ï¸ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
        </div>
        <div class="compose-form">
          <div class="form-group">
            <label>Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
            <input
              type="text"
              class="form-control"
              id="recipientSearch"
              placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…..."
              oninput="searchRecipient()"
            />
            <div class="search-results" id="recipientResults"></div>
            <input type="hidden" id="recipientId" />
            <div
              id="selectedRecipient"
              style="
                margin-top: 10px;
                padding: 10px;
                background: rgba(102, 126, 234, 0.2);
                border-radius: 8px;
                display: none;
              "
            ></div>
          </div>
          <div class="form-group">
            <label>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</label>
            <input
              type="text"
              class="form-control"
              id="messageSubject"
              placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©"
            />
          </div>
          <div class="form-group">
            <label>Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
            <textarea
              class="form-control"
              id="messageContent"
              placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."
            ></textarea>
          </div>
          <button class="btn btn-primary" onclick="sendMessage()">
            ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
          </button>
        </div>
      </section>

      <!-- Ù‚Ø³Ù… Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ -->
      <section id="section-contacts" class="section">
        <div class="section-header">
          <h2>ğŸ‘¥ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</h2>
          <button class="btn btn-primary" onclick="loadContacts()">
            ğŸ”„ ØªØ­Ø¯ÙŠØ«
          </button>
        </div>
        <div class="contacts-grid" id="contactsList">
          <div class="loading">
            <div class="spinner"></div>
            Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...
          </div>
        </div>
      </section>

      <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« -->
      <section id="section-search" class="section">
        <div class="section-header">
          <h2>ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¹Ø¶Ø§Ø¡</h2>
        </div>
        <div class="search-box">
          <input
            type="text"
            class="form-control"
            id="memberSearch"
            placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…..."
            oninput="searchMembers()"
          />
        </div>
        <div class="contacts-grid" id="searchResults">
          <div class="no-data">
            <div class="icon">ğŸ”</div>
            <p>Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¹Ø¶Ø§Ø¡</p>
          </div>
        </div>
      </section>

      <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
      <section id="section-profile" class="section">
        <div class="section-header">
          <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
        </div>
        <div class="profile-form">
          <div
            class="profile-image-upload"
            onclick="document.getElementById('profileImageInput').click()"
          >
            <span id="profileImagePreview">ğŸ“·</span>
          </div>
          <input
            type="file"
            id="profileImageInput"
            accept="image/*"
            style="display: none"
            onchange="previewProfileImage(event)"
          />

          <div class="form-group">
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
            <input
              type="text"
              class="form-control"
              id="profileFullName"
              placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"
            />
          </div>
          <div class="form-group">
            <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input
              type="email"
              class="form-control"
              id="profileEmail"
              placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
            />
          </div>
          <div class="form-group">
            <label>Ø§Ù„Ù†Ø¨Ø°Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</label>
            <textarea
              class="form-control"
              id="profileBio"
              placeholder="Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ø¹Ù†Ùƒ..."
              style="min-height: 100px"
            ></textarea>
          </div>
          <button class="btn btn-success" onclick="updateProfile()">
            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
          </button>
        </div>
      </section>

      <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·) -->
      <section id="section-admin" class="section">
        <div class="section-header">
          <h2>ğŸ›¡ï¸ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h2>
          <button class="btn btn-primary" onclick="loadPendingRegistrations()">
            ğŸ”„ ØªØ­Ø¯ÙŠØ«
          </button>
        </div>
        <div id="pendingList">
          <div class="loading">
            <div class="spinner"></div>
            Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...
          </div>
        </div>
      </section>
    </main>

    <!-- Modal Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© -->
    <div class="modal" id="messageModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalSubject">Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</h3>
          <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div style="color: #888; margin-bottom: 15px">
          <span id="modalSender"></span> â€¢ <span id="modalDate"></span>
        </div>
        <div id="modalContent" style="line-height: 1.8"></div>
        <div style="margin-top: 20px">
          <button class="btn btn-primary" onclick="replyToMessage()">
            â†©ï¸ Ø±Ø¯
          </button>
          <button class="btn btn-danger" onclick="deleteCurrentMessage()">
            ğŸ—‘ï¸ Ø­Ø°Ù
          </button>
        </div>
      </div>
    </div>

    <script>
      const API_URL =
        "https://akram-organization-production.up.railway.app/api";
      let currentUser = null;
      let currentMessageId = null;
      let inboxMessages = [];
      let outboxMessages = [];

      // ========== Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ==========
      function checkAuth() {
        const token =
          localStorage.getItem("token") || localStorage.getItem("auth_token");
        if (!token) {
          window.location.href = "login.html";
          return;
        }
        // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„Ø£Ø¯Ù…Ù†
        const isAdmin = localStorage.getItem("is_admin");
        if (isAdmin === "1" || isAdmin === 1 || isAdmin === true) {
          document.getElementById("adminNavItem").style.display = "block";
        }
      }

      function getToken() {
        let token =
          localStorage.getItem("token") || localStorage.getItem("auth_token");
        if (token && !token.startsWith("Bearer ")) {
          token = "Bearer " + token;
        }
        return token;
      }

      function getAuthHeaders() {
        return {
          "Content-Type": "application/json",
          Authorization: getToken(),
        };
      }

      // ========== Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ==========
      function showToast(message, type = "info") {
        const existing = document.querySelector(".toast");
        if (existing) existing.remove();

        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => toast.remove(), 3000);
      }

      // ========== Ø§Ù„ØªÙ†Ù‚Ù„ ==========
      function showSection(section) {
        // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        document
          .querySelectorAll(".section")
          .forEach((s) => s.classList.remove("active"));
        document
          .querySelectorAll(".nav-link")
          .forEach((l) => l.classList.remove("active"));

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
        const sectionEl = document.getElementById(`section-${section}`);
        if (sectionEl) sectionEl.classList.add("active");
        if (event && event.target) event.target.classList.add("active");

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        const titles = {
          home: "ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
          inbox: "ğŸ“¥ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©",
          outbox: "ğŸ“¤ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©",
          compose: "âœ‰ï¸ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©",
          contacts: "ğŸ‘¥ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„",
          search: "ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¹Ø¶Ø§Ø¡",
          profile: "âš™ï¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ",
          admin: "ğŸ›¡ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡",
        };
        document.getElementById("pageTitle").textContent =
          titles[section] || "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…";

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
        if (section === "inbox") loadInbox();
        else if (section === "outbox") loadOutbox();
        else if (section === "contacts") loadContacts();
        else if (section === "admin") loadPendingRegistrations();
        else if (section === "home") {
          loadInbox(); // Ù„ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
        document.getElementById("sidebar").classList.remove("open");
      }

      function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("open");
      }

      // ========== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ==========
      async function loadProfile() {
        try {
          const res = await fetch(`${API_URL}/user/profile`, {
            headers: getAuthHeaders(),
          });

          if (!res.ok) {
            console.error("Profile response:", res.status);
            throw new Error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ");
          }

          const data = await res.json();
          // Ø§Ù„Ù€ API ÙŠØ±Ø¬Ø¹ { user: {...}, stats: {...} }
          currentUser = data.user || data;

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
          document.getElementById("sidebarName").textContent =
            currentUser.full_name || currentUser.username;
          document.getElementById(
            "sidebarUsername"
          ).textContent = `@${currentUser.username}`;

          // ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
          if (currentUser.profile_image) {
            document.getElementById(
              "sidebarAvatar"
            ).innerHTML = `<img src="${currentUser.profile_image}" alt="">`;
          }

          // ØªØ­Ø¯ÙŠØ« Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
          document.getElementById("profileFullName").value =
            currentUser.full_name || "";
          document.getElementById("profileEmail").value =
            currentUser.email || "";
          document.getElementById("profileBio").value = currentUser.bio || "";

          if (currentUser.profile_image) {
            document.getElementById(
              "profileImagePreview"
            ).innerHTML = `<img src="${currentUser.profile_image}" alt="" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;
          }

          // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
          if (currentUser.created_at) {
            const date = new Date(currentUser.created_at);
            document.getElementById("statJoinDate").textContent =
              date.toLocaleDateString("ar-SA", {
                month: "short",
                year: "numeric",
              });
          }
        } catch (e) {
          console.error(e);
          showToast("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ", "error");
        }
      }

      // ========== Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© ==========
      async function loadInbox() {
        const container = document.getElementById("inboxList");
        container.innerHTML =
          '<div class="loading"><div class="spinner"></div>Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

        try {
          const res = await fetch(`${API_URL}/messages/inbox`, {
            headers: { Authorization: getToken() },
          });

          const data = await res.json();
          inboxMessages = data.messages || data || [];

          document.getElementById("statInbox").textContent =
            inboxMessages.length;

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø§Ø¯Ø¬
          const unread = inboxMessages.filter((m) => !m.is_read).length;
          const badge = document.getElementById("inboxBadge");
          if (unread > 0) {
            badge.style.display = "inline";
            badge.textContent = unread;
          } else {
            badge.style.display = "none";
          }

          renderMessages(inboxMessages, container, "inbox");
          renderMessages(
            inboxMessages.slice(0, 5),
            document.getElementById("recentMessages"),
            "inbox"
          );
        } catch (e) {
          container.innerHTML =
            '<div class="no-data"><div class="icon">âŒ</div><p>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</p></div>';
        }
      }

      // ========== Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø© ==========
      async function loadOutbox() {
        const container = document.getElementById("outboxList");
        container.innerHTML =
          '<div class="loading"><div class="spinner"></div>Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

        try {
          const res = await fetch(`${API_URL}/messages/outbox`, {
            headers: { Authorization: getToken() },
          });

          const data = await res.json();
          outboxMessages = data.messages || data || [];

          document.getElementById("statOutbox").textContent =
            outboxMessages.length;
          renderMessages(outboxMessages, container, "outbox");
        } catch (e) {
          container.innerHTML =
            '<div class="no-data"><div class="icon">âŒ</div><p>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</p></div>';
        }
      }

      // ========== Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ==========
      function renderMessages(messages, container, type) {
        if (!messages || messages.length === 0) {
          container.innerHTML =
            '<div class="no-data"><div class="icon">ğŸ“­</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</p></div>';
          return;
        }

        container.innerHTML = messages
          .map(
            (msg) => `
          <div class="message-card ${
            msg.is_read ? "" : "unread"
          }" onclick="openMessage(${msg.id}, '${type}')">
            <div class="message-header">
              <span class="message-sender">${
                type === "inbox"
                  ? msg.full_name || msg.username || msg.sender_name || "Ù…Ø¬Ù‡ÙˆÙ„"
                  : msg.full_name ||
                    msg.username ||
                    msg.receiver_name ||
                    "Ù…Ø¬Ù‡ÙˆÙ„"
              }</span>
              <span class="message-date">${formatDate(msg.created_at)}</span>
            </div>
            <div class="message-subject">${msg.subject || "Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ¶ÙˆØ¹"}</div>
            <div class="message-preview">${
              msg.content?.substring(0, 100) || ""
            }</div>
          </div>
        `
          )
          .join("");
      }

      function formatDate(dateStr) {
        if (!dateStr) return "";
        const date = new Date(dateStr);
        return date.toLocaleDateString("ar-SA");
      }

      // ========== ÙØªØ­ Ø±Ø³Ø§Ù„Ø© ==========
      function openMessage(id, type) {
        const messages = type === "inbox" ? inboxMessages : outboxMessages;
        const msg = messages.find((m) => m.id === id);
        if (!msg) return;

        currentMessageId = id;

        const senderName =
          msg.full_name || msg.username || msg.sender_name || "Ù…Ø¬Ù‡ÙˆÙ„";
        const receiverName =
          msg.full_name || msg.username || msg.receiver_name || "Ù…Ø¬Ù‡ÙˆÙ„";

        document.getElementById("modalSubject").textContent =
          msg.subject || "Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ¶ÙˆØ¹";
        document.getElementById("modalSender").textContent =
          type === "inbox" ? `Ù…Ù†: ${senderName}` : `Ø¥Ù„Ù‰: ${receiverName}`;
        document.getElementById("modalDate").textContent = formatDate(
          msg.created_at
        );
        document.getElementById("modalContent").textContent = msg.content;

        document.getElementById("messageModal").classList.add("show");

        // ØªØ­Ø¯ÙŠØ¯ ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø©
        if (type === "inbox" && !msg.is_read) {
          markAsRead(id);
        }
      }

      function closeModal() {
        document.getElementById("messageModal").classList.remove("show");
      }

      async function markAsRead(id) {
        try {
          await fetch(`${API_URL}/messages/${id}/mark-read`, {
            method: "POST",
            headers: { Authorization: getToken() },
          });
          loadInbox();
        } catch (e) {}
      }

      // ========== Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ ==========
      async function loadContacts() {
        const container = document.getElementById("contactsList");
        container.innerHTML =
          '<div class="loading"><div class="spinner"></div>Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

        try {
          const res = await fetch(`${API_URL}/contacts`, {
            headers: { Authorization: getToken() },
          });

          const data = await res.json();
          const contacts = data.contacts || data || [];

          document.getElementById("statContacts").textContent = contacts.length;

          if (contacts.length === 0) {
            container.innerHTML =
              '<div class="no-data"><div class="icon">ğŸ‘¥</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù‡Ø§Øª Ø§ØªØµØ§Ù„</p></div>';
            return;
          }

          container.innerHTML = contacts
            .map(
              (c) => `
            <div class="contact-card">
              <div class="contact-avatar">ğŸ‘¤</div>
              <div class="contact-name">${c.full_name || c.username}</div>
              <div class="contact-username">@${c.username}</div>
              <button class="btn btn-primary" onclick="startMessageTo(${
                c.id
              }, '${c.full_name || c.username}')">âœ‰ï¸ Ù…Ø±Ø§Ø³Ù„Ø©</button>
            </div>
          `
            )
            .join("");
        } catch (e) {
          container.innerHTML =
            '<div class="no-data"><div class="icon">âŒ</div><p>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</p></div>';
        }
      }

      // ========== Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¹Ø¶Ø§Ø¡ ==========
      let searchTimeout;
      async function searchMembers() {
        clearTimeout(searchTimeout);
        const query = document.getElementById("memberSearch").value.trim();
        const container = document.getElementById("searchResults");

        if (query.length < 2) {
          container.innerHTML =
            '<div class="no-data"><div class="icon">ğŸ”</div><p>Ø§ÙƒØªØ¨ Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø¨Ø­Ø«</p></div>';
          return;
        }

        searchTimeout = setTimeout(async () => {
          container.innerHTML =
            '<div class="loading"><div class="spinner"></div>Ø¬Ø§Ø±Ù Ø§Ù„Ø¨Ø­Ø«...</div>';

          try {
            const res = await fetch(
              `${API_URL}/users/search?q=${encodeURIComponent(query)}`,
              {
                headers: { Authorization: getToken() },
              }
            );

            const data = await res.json();
            const users = data.users || data || [];

            if (users.length === 0) {
              container.innerHTML =
                '<div class="no-data"><div class="icon">ğŸ˜•</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p></div>';
              return;
            }

            container.innerHTML = users
              .map(
                (u) => `
              <div class="contact-card">
                <div class="contact-avatar">ğŸ‘¤</div>
                <div class="contact-name">${u.full_name || u.username}</div>
                <div class="contact-username">@${u.username}</div>
                <div style="display:flex;gap:8px;flex-wrap:wrap;">
                  <button class="btn btn-primary" onclick="startMessageTo(${
                    u.id
                  }, '${(u.full_name || u.username).replace(
                  /'/g,
                  "\\'"
                )}')">âœ‰ï¸ Ù…Ø±Ø§Ø³Ù„Ø©</button>
                  <button class="btn btn-success" onclick="addContact(${
                    u.id
                  })">â• Ø¥Ø¶Ø§ÙØ©</button>
                </div>
              </div>
            `
              )
              .join("");
          } catch (e) {
            container.innerHTML =
              '<div class="no-data"><div class="icon">âŒ</div><p>ÙØ´Ù„ Ø§Ù„Ø¨Ø­Ø«</p></div>';
          }
        }, 300);
      }

      // ========== Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªÙ„Ù… ==========
      async function searchRecipient() {
        clearTimeout(searchTimeout);
        const query = document.getElementById("recipientSearch").value.trim();
        const container = document.getElementById("recipientResults");

        if (query.length < 2) {
          container.innerHTML = "";
          return;
        }

        searchTimeout = setTimeout(async () => {
          try {
            const res = await fetch(
              `${API_URL}/users/search?q=${encodeURIComponent(query)}`,
              {
                headers: { Authorization: getToken() },
              }
            );

            const data = await res.json();
            const users = data.users || data || [];

            container.innerHTML = users
              .map(
                (u) => `
              <div class="search-result-item" onclick="selectRecipient(${
                u.id
              }, '${u.full_name || u.username}', '${u.username}')">
                <div class="contact-avatar" style="width:40px;height:40px;font-size:1rem;">ğŸ‘¤</div>
                <div>
                  <div style="font-weight:600">${
                    u.full_name || u.username
                  }</div>
                  <div style="color:#888;font-size:0.8rem;">@${u.username}</div>
                </div>
              </div>
            `
              )
              .join("");
          } catch (e) {}
        }, 300);
      }

      function selectRecipient(id, name, username) {
        document.getElementById("recipientId").value = id;
        document.getElementById("recipientSearch").value = "";
        document.getElementById("recipientResults").innerHTML = "";
        document.getElementById("selectedRecipient").style.display = "block";
        document.getElementById("selectedRecipient").innerHTML = `
          <strong>${name}</strong> (@${username})
          <button onclick="clearRecipient()" style="float:left;background:none;border:none;color:#ff6b6b;cursor:pointer;">âœ•</button>
        `;
      }

      function clearRecipient() {
        document.getElementById("recipientId").value = "";
        document.getElementById("selectedRecipient").style.display = "none";
      }

      function startMessageTo(id, name) {
        showSection("compose");
        selectRecipient(id, name, name);
      }

      // ========== Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ==========
      async function sendMessage() {
        const receiverId = document.getElementById("recipientId").value;
        const subject = document.getElementById("messageSubject").value.trim();
        const content = document.getElementById("messageContent").value.trim();

        if (!receiverId) {
          showToast("Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙ„Ù… Ø£ÙˆÙ„Ø§Ù‹", "error");
          return;
        }
        if (!content) {
          showToast("Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©", "error");
          return;
        }

        try {
          const res = await fetch(`${API_URL}/messages/send`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: getToken(),
            },
            body: JSON.stringify({
              receiver_id: parseInt(receiverId),
              subject: subject || "Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ¶ÙˆØ¹",
              content: content,
            }),
          });

          if (res.ok) {
            showToast("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­", "success");
            clearRecipient();
            document.getElementById("messageSubject").value = "";
            document.getElementById("messageContent").value = "";
            loadOutbox();
          } else {
            const err = await res.json();
            showToast(err.error || "ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©", "error");
          }
        } catch (e) {
          showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„", "error");
        }
      }

      function replyToMessage() {
        closeModal();
        showSection("compose");
      }

      async function deleteCurrentMessage() {
        if (!currentMessageId) return;
        if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ")) return;

        try {
          await fetch(`${API_URL}/messages/${currentMessageId}`, {
            method: "DELETE",
            headers: { Authorization: getToken() },
          });
          closeModal();
          showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©", "success");
          loadInbox();
          loadOutbox();
        } catch (e) {
          showToast("ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©", "error");
        }
      }

      // ========== Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ==========
      function previewProfileImage(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById(
            "profileImagePreview"
          ).innerHTML = `<img src="${e.target.result}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;
        };
        reader.readAsDataURL(file);
      }

      async function updateProfile() {
        showToast("Ø¬Ø§Ø±Ù Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª...", "info");

        // Ù…Ù„Ø§Ø­Ø¸Ø©: API ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ù‚Ø¯ Ù„Ø§ ÙŠÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ - Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
        setTimeout(() => {
          showToast("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª", "success");
        }, 1000);
      }

      // ========== Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„ ==========
      async function addContact(contactId) {
        try {
          const res = await fetch(`${API_URL}/contacts/add`, {
            method: "POST",
            headers: getAuthHeaders(),
            body: JSON.stringify({ contact_id: contactId }),
          });

          if (res.ok) {
            showToast("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„", "success");
            loadContacts();
          } else {
            const err = await res.json();
            showToast(err.error || "ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„", "error");
          }
        } catch (e) {
          showToast("Ø­Ø¯Ø« Ø®Ø·Ø£", "error");
        }
      }

      // ========== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ (Ø£Ø¯Ù…Ù†) ==========
      async function loadPendingRegistrations() {
        const container = document.getElementById("pendingList");
        container.innerHTML =
          '<div class="loading"><div class="spinner"></div>Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

        try {
          const res = await fetch(`${API_URL}/admin/pending-registrations`, {
            headers: { Authorization: getToken() },
          });

          if (res.status === 403) {
            container.innerHTML =
              '<div class="no-data"><div class="icon">ğŸ”’</div><p>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª</p></div>';
            return;
          }

          const pending = await res.json();

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø§Ø¯Ø¬
          const badge = document.getElementById("adminBadge");
          if (pending.length > 0) {
            badge.style.display = "inline";
            badge.textContent = pending.length;
          } else {
            badge.style.display = "none";
          }

          if (pending.length === 0) {
            container.innerHTML =
              '<div class="no-data"><div class="icon">âœ…</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p></div>';
            return;
          }

          container.innerHTML = pending
            .map(
              (req) => `
            <div class="message-card" style="border-right-color: var(--warning);">
              <div class="message-header">
                <span class="message-sender">${
                  req.full_name || req.username
                }</span>
                <span class="message-date">${formatDate(req.created_at)}</span>
              </div>
              <div style="margin-bottom: 10px;">
                <div><strong>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> @${req.username}</div>
                <div><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${req.email}</div>
                <div><strong>Ø§Ù„Ù†Ø¨Ø°Ø©:</strong> ${req.bio || "Ø¨Ø¯ÙˆÙ†"}</div>
              </div>
              <div style="display: flex; gap: 10px;">
                <button class="btn btn-success" onclick="approveUser(${
                  req.id
                })">âœ… Ù…ÙˆØ§ÙÙ‚Ø©</button>
                <button class="btn btn-danger" onclick="rejectUser(${
                  req.id
                })">âŒ Ø±ÙØ¶</button>
              </div>
            </div>
          `
            )
            .join("");
        } catch (e) {
          container.innerHTML =
            '<div class="no-data"><div class="icon">âŒ</div><p>ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„</p></div>';
        }
      }

      async function approveUser(id) {
        try {
          const res = await fetch(
            `${API_URL}/admin/approve-registration/${id}`,
            {
              method: "POST",
              headers: { Authorization: getToken() },
            }
          );

          if (res.ok) {
            showToast("âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©", "success");
            loadPendingRegistrations();
          } else {
            showToast("ÙØ´Ù„Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©", "error");
          }
        } catch (e) {
          showToast("Ø­Ø¯Ø« Ø®Ø·Ø£", "error");
        }
      }

      async function rejectUser(id) {
        const reason = prompt("Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):");
        try {
          const res = await fetch(
            `${API_URL}/admin/reject-registration/${id}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: getToken(),
              },
              body: JSON.stringify({ reason: reason || "" }),
            }
          );

          if (res.ok) {
            showToast("ØªÙ… Ø§Ù„Ø±ÙØ¶", "info");
            loadPendingRegistrations();
          } else {
            showToast("ÙØ´Ù„ Ø§Ù„Ø±ÙØ¶", "error");
          }
        } catch (e) {
          showToast("Ø­Ø¯Ø« Ø®Ø·Ø£", "error");
        }
      }

      // ========== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ==========
      function logout() {
        localStorage.clear();
        window.location.href = "login.html";
      }

      // ========== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ==========
      checkAuth();
      loadProfile();
      loadInbox();
      loadContacts();

      // ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ø£Ø¯Ù…Ù†
      const isAdmin = localStorage.getItem("is_admin");
      if (isAdmin === "1" || isAdmin === 1) {
        loadPendingRegistrations();
      }
    </script>
  </body>
</html>
